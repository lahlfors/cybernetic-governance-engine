# Governance Crosswalk: Mapping Law to Logic

This document serves as the formal **Governance Crosswalk**, mapping high-level regulatory controls (ISO 42001, NIST RMF) to specific engineering artifacts (STPA Constraints, NeMo Rails, Rego Policies) within the Green Stack architecture.

## The Crosswalk Table

| Governance Requirement (Source) | Risk Category (NIST RMF) | System Constraint (STPA) | Technical Implementation (Enforcement) |
| :--- | :--- | :--- | :--- |
| **ISO A.5.2**: Social impact assessment. | Map 1.1: Contextual analysis. | **SC-1**: Agent must not output content classified as 'Hate Speech' or 'Bias'. | **NeMo Output Rail**: `self check output` (Toxicity Classifier). |
| **ISO A.9.2**: Data transfer to suppliers. | Govern 2.1: Data privacy. | **SC-2**: Agent must not send PII to external Model APIs. | **NeMo Input Rail**: `presidio-anonymization` (Configured in `config/rails/config.yml`). |
| **NIST Manage 2.4**: System security. | Manage 2.4: Integrity. | **SC-3**: Agent must not execute 'DROP' or 'DELETE' SQL commands. | **OPA Policy (Rego)**: `deny { input.sql matches "DROP" }` (Generated by Transpiler). |
| **Corporate Policy 1.4**: Fiscal limits. | Govern 4.1: Risk tolerance. | **SC-4**: Financial transfers > $10k require human approval. | **Safety Node + OPA**: `finance_policy.rego` rule `MANUAL_REVIEW`. |
| **NIST Map 1.5**: Data Latency/Quality. | Map 1.5: Data Quality. | **SC-5**: Do not trade on stale data (>100ms latency). | **NeMo Action**: `check_data_latency` (Generated by Transpiler). |
| **EU AI Act**: Human Oversight. | Governance. | **SC-6**: High-risk actions must have HITL. | **LangGraph**: `interrupt_before=["human_review"]`. |

## Implementation Details

### 1. Automated Policy Derivation
The `src/governance/transpiler.py` module implements the automated derivation of SC-3 and SC-5. It converts `ProposedUCA` objects from the offline Risk Analyst into:
1.  **Python Actions** for NeMo Guardrails (e.g., `check_data_latency`).
2.  **Rego Rules** for Open Policy Agent (e.g., `decision = "DENY" if ...`).

### 2. Structural Enforcement
The **Safety Node** (`src/graph/nodes/safety_node.py`) explicitly enforces SC-4. It acts as a gatekeeper between the `execution_analyst` (Planner) and `governed_trader` (Executor), querying OPA for every proposed plan.

### 3. Continuous Audit
The **Automated Auditor** (`scripts/automated_auditor.py`) verifies that SC-4 is never bypassed. It analyzes OpenTelemetry traces to ensure that every `tool.execution` span is causally preceded by a `governance.check` span with a decision of `ALLOW`.
