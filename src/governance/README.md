# Governance Logic (Layer 3: Enforcement & Bridge)

This directory contains the "Symbolic Control" layer that bridges Policy to Code and enforces Safety in Real-Time.

## Components

### 1. The Transpiler (`transpiler.py`)
**Role:** Automated Rule Derivation (Phase 3).
*   **Input:** Structured `ProposedUCA` objects from the Risk Analyst.
*   **Process:** Parses `constraint_logic` (variable, operator, threshold).
*   **Output:** Generates Python code strings for NeMo actions.
*   **Supported Logic:**
    *   `check_slippage_risk` (Volume based)
    *   `check_drawdown_limit` (Portfolio based)
    *   `check_data_latency` (Temporal)
    *   `check_atomic_execution` (State based)

### 2. NeMo Actions (`nemo_actions.py`)
**Role:** Real-Time Enforcement (Phase 4).
These functions are called by NeMo Guardrails during the "Hot Path" of execution. They implement a **Hybrid Policy** model:

*   **Static Mechanism (CBF):** Critical safety checks like **Drawdown Limit** are hardcoded as **Control Barrier Functions** ($h(x) = Limit - Value$). This ensures mathematical rigor and prevents AI hallucinations from altering the safety logic itself.
*   **Dynamic Policy (Configuration):** While the *logic* is static, the *parameters* (e.g., the specific drawdown limit) are read dynamically from `safety_params.json` (see below).
*   **Characteristics:**
    *   **Deterministic:** No LLM calls. Execution < 10ms.
    *   **State Aware:** Checks `audit_trail` for multi-leg trade integrity.
    *   **Input Sanitization:** Strictly validates dynamic configuration (e.g., 0.0 < limit < 1.0) and falls back to safe defaults (5%) on error.

### 3. Generated Actions (`generated_actions.py`)
A file strictly managed by the `offline_risk_update.py` script. It contains the "Hot Swapped" rules derived from the latest Risk Discovery cycle. `nemo_actions.py` dynamically imports from here for less critical, purely dynamic checks (e.g., Slippage Risk).

### 4. Safety Parameters (`safety_params.json`)
A JSON configuration file generated by the offline Risk Analyst.
*   **Role:** Separation of Policy (Value) from Mechanism (Code).
*   **Update Mechanism:** Updated atomically via `os.replace` by `scripts/offline_risk_update.py`.
*   **Content:** Contains key safety thresholds like `drawdown_limit`.
