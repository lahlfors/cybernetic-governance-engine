# Use a lightweight Python base image
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Install python dependencies
# We install dependencies needed for NeMo Guardrails + gRPC + OpenTelemetry
RUN pip install --no-cache-dir \
    nemoguardrails \
    grpcio \
    grpcio-tools \
    protobuf \
    opentelemetry-api \
    opentelemetry-sdk \
    litellm \
    nest_asyncio \
    google-cloud-aiplatform \
    langchain-google-genai \
    langchain-google-vertexai

# Copy source code
COPY src /app/src
COPY config /app/config

# Expose port
EXPOSE 8000

# Command to run the application (gRPC Server)
CMD ["python", "src/gateway/governance/nemo/server.py"]
